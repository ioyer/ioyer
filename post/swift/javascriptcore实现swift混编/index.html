<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Javaâ€‹Scriptâ€‹Coreå®ç°swiftæ··ç¼– - Even - A super concise theme for Hugo</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="iTBoyer" /><meta name="description" content="OS X Mavericks å’Œ iOS 7 å¼•å…¥äº† JavaScriptCore åº“ï¼Œå®ƒæŠŠ WebKit çš„ JavaScript å¼•æ“ç”¨ Objective-C å°è£…ï¼Œæä¾›äº†ç®€å•ï¼Œå¿«é€Ÿä»¥åŠå®‰å…¨çš„æ–¹å¼æ¥å…¥ä¸–ç•Œä¸Šæœ€æµè¡Œçš„è¯­è¨€ã€‚ä¸ç®¡ä½ çˆ±å®ƒè¿˜æ˜¯æ¨å®ƒï¼ŒJavaScrip" /><meta name="keywords" content="æ··ç¼–,IOS" />






<meta name="generator" content="Hugo 0.56.3 with even 4.0.0" />


<link rel="canonical" href="https://huos3203.github.io/post/swift/javascriptcore%E5%AE%9E%E7%8E%B0swift%E6%B7%B7%E7%BC%96/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<link href="/dist/even.c2a46f00.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Javaâ€‹Scriptâ€‹Coreå®ç°swiftæ··ç¼–" />
<meta property="og:description" content="OS X Mavericks å’Œ iOS 7 å¼•å…¥äº† JavaScriptCore åº“ï¼Œå®ƒæŠŠ WebKit çš„ JavaScript å¼•æ“ç”¨ Objective-C å°è£…ï¼Œæä¾›äº†ç®€å•ï¼Œå¿«é€Ÿä»¥åŠå®‰å…¨çš„æ–¹å¼æ¥å…¥ä¸–ç•Œä¸Šæœ€æµè¡Œçš„è¯­è¨€ã€‚ä¸ç®¡ä½ çˆ±å®ƒè¿˜æ˜¯æ¨å®ƒï¼ŒJavaScrip" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://huos3203.github.io/post/swift/javascriptcore%E5%AE%9E%E7%8E%B0swift%E6%B7%B7%E7%BC%96/" />
<meta property="article:published_time" content="2017-02-12T13:34:06+00:00" />
<meta property="article:modified_time" content="2019-08-08T17:46:02+08:00" />
<meta itemprop="name" content="Javaâ€‹Scriptâ€‹Coreå®ç°swiftæ··ç¼–">
<meta itemprop="description" content="OS X Mavericks å’Œ iOS 7 å¼•å…¥äº† JavaScriptCore åº“ï¼Œå®ƒæŠŠ WebKit çš„ JavaScript å¼•æ“ç”¨ Objective-C å°è£…ï¼Œæä¾›äº†ç®€å•ï¼Œå¿«é€Ÿä»¥åŠå®‰å…¨çš„æ–¹å¼æ¥å…¥ä¸–ç•Œä¸Šæœ€æµè¡Œçš„è¯­è¨€ã€‚ä¸ç®¡ä½ çˆ±å®ƒè¿˜æ˜¯æ¨å®ƒï¼ŒJavaScrip">


<meta itemprop="datePublished" content="2017-02-12T13:34:06&#43;00:00" />
<meta itemprop="dateModified" content="2019-08-08T17:46:02&#43;08:00" />
<meta itemprop="wordCount" content="2346">



<meta itemprop="keywords" content="Javaâ€‹Scriptâ€‹Core,æ··ç¼–,swift,è¯­æ³•,iOS,macOS," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Javaâ€‹Scriptâ€‹Coreå®ç°swiftæ··ç¼–"/>
<meta name="twitter:description" content="OS X Mavericks å’Œ iOS 7 å¼•å…¥äº† JavaScriptCore åº“ï¼Œå®ƒæŠŠ WebKit çš„ JavaScript å¼•æ“ç”¨ Objective-C å°è£…ï¼Œæä¾›äº†ç®€å•ï¼Œå¿«é€Ÿä»¥åŠå®‰å…¨çš„æ–¹å¼æ¥å…¥ä¸–ç•Œä¸Šæœ€æµè¡Œçš„è¯­è¨€ã€‚ä¸ç®¡ä½ çˆ±å®ƒè¿˜æ˜¯æ¨å®ƒï¼ŒJavaScrip"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Even</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">ä¸»é¡µ</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">å½’æ¡£</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">æ ‡ç­¾ğŸ·ï¸</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">åˆ†ç±»</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Even</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">ä¸»é¡µ</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">å½’æ¡£</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">æ ‡ç­¾ğŸ·ï¸</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">åˆ†ç±»</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Javaâ€‹Scriptâ€‹Coreå®ç°swiftæ··ç¼–</h1>

      <div class="post-meta">
        <span class="post-time"> 2017-02-12 </span>
        <div class="post-category">
            <a href="/categories/swift/"> swift </a>
            <a href="/categories/js%E6%B7%B7%E7%BC%96/"> JSæ··ç¼– </a>
            </div>
          <span class="more-meta"> çº¦ 2346 å­— </span>
          <span class="more-meta"> é¢„è®¡é˜…è¯» 5 åˆ†é’Ÿ </span>
        <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> æ¬¡é˜…è¯» </span>
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">æ–‡ç« ç›®å½•</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#swifté€šè¿‡jscontextè°ƒç”¨javascript">swifté€šè¿‡JSContextè°ƒç”¨JavaScript</a>
<ul>
<li><a href="#å…¨å±€å®ä¾‹jscontext-è¿è¡Œjavascriptä»£ç çš„ç¯å¢ƒ">å…¨å±€å®ä¾‹JSContextï¼šè¿è¡ŒJavaScriptä»£ç çš„ç¯å¢ƒ</a></li>
<li><a href="#åŠ¨æ€ç±»å‹jsvalue-åŒ…è£¹jscontextç¯å¢ƒä¸‹æ¯ä¸€ä¸ªå¯èƒ½çš„jså€¼">åŠ¨æ€ç±»å‹JSValue:åŒ…è£¹JSContextç¯å¢ƒä¸‹æ¯ä¸€ä¸ªå¯èƒ½çš„JSå€¼</a></li>
<li><a href="#ä¸‹æ ‡å–å€¼-è®¿é—®jscontextç¯å¢ƒä¸‹çš„ä»»ä½•å€¼">ä¸‹æ ‡å–å€¼ï¼šè®¿é—®JSContextç¯å¢ƒä¸‹çš„ä»»ä½•å€¼</a>
<ul>
<li><a href="#jscontextä¸‹æ ‡å–å€¼">JSContextä¸‹æ ‡å–å€¼</a></li>
<li><a href="#jsvalueæ•´æ•°ä¸‹æ ‡åŸå§‹æ–¹æ³•">JSValueæ•´æ•°ä¸‹æ ‡åŸå§‹æ–¹æ³•</a></li>
</ul></li>
<li><a href="#callwithargumentsè°ƒç”¨jsæ–¹æ³•-åªéœ€ä¼ å…¥foundationåŸºæœ¬ç±»å‹å‚æ•°">callWithArgumentsè°ƒç”¨JSæ–¹æ³•ï¼šåªéœ€ä¼ å…¥FoundationåŸºæœ¬ç±»å‹å‚æ•°</a></li>
<li><a href="#exceptionhandler-é”™è¯¯å¤„ç†"><code>exceptionHandler</code>é”™è¯¯å¤„ç†</a></li>
</ul></li>
<li><a href="#javascript-é€šè¿‡jscontextè°ƒç”¨-swift-oc">JavaScript é€šè¿‡JSContextè°ƒç”¨ swiftï¼OC</a>
<ul>
<li><a href="#blockå—-é”®å€¼å¯¹-è¯¥blocké”®çš„-jsvalue-é€šè¿‡-callwitharguments-è°ƒç”¨">blockå— é”®å€¼å¯¹:è¯¥blocké”®çš„<code>JSValue</code>é€šè¿‡<code>callWithArguments</code>è°ƒç”¨</a>
<ul>
<li><a href="#å†…å­˜ç®¡ç†">å†…å­˜ç®¡ç†</a></li>
</ul></li>
<li><a href="#jsexport-åè®®">JSExport åè®®</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
  </div>
</div>
    <div class="post-content">
      

<p>OS X Mavericks å’Œ iOS 7 å¼•å…¥äº† <code>JavaScriptCore</code> åº“ï¼Œå®ƒæŠŠ <code>WebKit çš„ JavaScript</code> å¼•æ“ç”¨ <code>Objective-C</code> å°è£…ï¼Œæä¾›äº†ç®€å•ï¼Œå¿«é€Ÿä»¥åŠå®‰å…¨çš„æ–¹å¼æ¥å…¥ä¸–ç•Œä¸Šæœ€æµè¡Œçš„è¯­è¨€ã€‚ä¸ç®¡ä½ çˆ±å®ƒè¿˜æ˜¯æ¨å®ƒï¼Œ<code>JavaScript</code> çš„æ™®éå­˜åœ¨ä½¿å¾—ç¨‹åºå‘˜ã€å·¥å…·ä»¥åŠèåˆåˆ° OS X å’Œ iOS é‡Œè¿™æ ·è¶…å¿«çš„è™šæ‹Ÿæœºä¸­èµ„æºçš„ä½¿ç”¨éƒ½å¤§å¹…å¢é•¿ã€‚</p>

<ol>
<li>å¦‚ä½•ä» <code>JavaScript ç¯å¢ƒ</code>ä¸­æå–å€¼ä»¥åŠå¦‚ä½•è°ƒç”¨å…¶ä¸­å®šä¹‰çš„å‡½æ•°?</li>
<li>é‚£ä¹ˆåå‘å‘¢ï¼Ÿæ€æ ·ä» <code>JavaScript</code> è®¿é—®æˆ‘ä»¬åœ¨ <code>Objective-C</code>æˆ– <code>Swift</code> å®šä¹‰çš„å¯¹è±¡å’Œæ–¹æ³•ï¼Ÿ</li>
</ol>

<h2 id="swifté€šè¿‡jscontextè°ƒç”¨javascript">swifté€šè¿‡JSContextè°ƒç”¨JavaScript</h2>

<p>å¦‚ä½•ä»<code>JavaScript ç¯å¢ƒ</code>ä¸­æå–å€¼ä»¥åŠå¦‚ä½•è°ƒç”¨å…¶ä¸­å®šä¹‰çš„å‡½æ•°?</p>

<h3 id="å…¨å±€å®ä¾‹jscontext-è¿è¡Œjavascriptä»£ç çš„ç¯å¢ƒ">å…¨å±€å®ä¾‹JSContextï¼šè¿è¡ŒJavaScriptä»£ç çš„ç¯å¢ƒ</h3>

<p>å…¨å±€å®ä¾‹<code>JSContext</code>ä½œç”¨å°±åƒåœ¨æµè§ˆå™¨å†…è¿è¡Œçš„ä¸€ä¸ª<code>JavaScript</code>è„šæœ¬ï¼Œ<code>JSContext</code> ç±»ä¼¼äº <code>window</code>ã€‚
é€šè¿‡<code>JSContext</code>å®ä¾‹è¿è¡Œ<code>JavaScript</code>ä»£ç <code>åˆ›å»ºå˜é‡</code>ï¼Œ<code>åšè®¡ç®—</code>ï¼Œ<code>å®šä¹‰æ–¹æ³•</code>ï¼š
{% codeblock  lang:swift %}
let context = JSContext()    //åˆ›å»ºå…¨å±€ç¯å¢ƒ
context.evaluateScript(&ldquo;var num = 5 + 5&rdquo;) //è®¡ç®—
context.evaluateScript(&ldquo;var names = [&lsquo;Grace&rsquo;, &lsquo;Ada&rsquo;, &lsquo;Margaret&rsquo;]&ldquo;) //å®šä¹‰å˜é‡
context.evaluateScript(&ldquo;var triple = function(value) { return value * 3 }&ldquo;) //å®šä¹‰æ–¹æ³•
let tripleNum: JSValue = context.evaluateScript(&ldquo;triple(num)&rdquo;)<br />
{% endcodeblock %}</p>

<h3 id="åŠ¨æ€ç±»å‹jsvalue-åŒ…è£¹jscontextç¯å¢ƒä¸‹æ¯ä¸€ä¸ªå¯èƒ½çš„jså€¼">åŠ¨æ€ç±»å‹JSValue:åŒ…è£¹JSContextç¯å¢ƒä¸‹æ¯ä¸€ä¸ªå¯èƒ½çš„JSå€¼</h3>

<p><code>JavaScript</code> æ˜¯åŠ¨æ€è¯­è¨€ï¼Œæ‰€ä»¥åŠ¨æ€ç±»å‹<code>JSValue</code>åŒ…è£¹JSContextç¯å¢ƒä¸­ä»»ä½•å¯èƒ½çš„JSå€¼ï¼Œå­—ç¬¦ä¸²å’Œæ•°å­—ï¼›æ•°ç»„ã€å¯¹è±¡å’Œæ–¹æ³•ï¼›ç”šè‡³é”™è¯¯å’Œç‰¹æ®Šçš„ JavaScript å€¼è¯¸å¦‚ <code>null</code> å’Œ <code>undefined</code>ã€‚
è·å–<code>tripleNum</code>å€¼ï¼š
{% codeblock  lang:swift %}
println(&ldquo;Tripled: (tripleNum.toInt32())&ldquo;)
{% endcodeblock %}
<code>JSValue</code> åŒ…æ‹¬ä¸€ç³»åˆ—æ–¹æ³•ç”¨äºè®¿é—®å…¶å¯èƒ½çš„å€¼ä»¥ä¿è¯æœ‰æ­£ç¡®çš„ <code>Foundation åŸºæœ¬ç±»å‹</code>
åŒ…æ‹¬ï¼š</p>

<h3 id="ä¸‹æ ‡å–å€¼-è®¿é—®jscontextç¯å¢ƒä¸‹çš„ä»»ä½•å€¼">ä¸‹æ ‡å–å€¼ï¼šè®¿é—®JSContextç¯å¢ƒä¸‹çš„ä»»ä½•å€¼</h3>

<p><code>JSContext</code> å’Œ <code>JSValue</code> å®ä¾‹å¯ä»¥ä½¿ç”¨ä¸‹æ ‡çš„æ–¹å¼è®¿é—®ä¹‹å‰åˆ›å»ºçš„ <code>context</code> çš„ä»»ä½•å€¼ã€‚
* <code>JSContext</code>ï¼šéœ€è¦ä¸€ä¸ªå­—ç¬¦ä¸²ä¸‹æ ‡
* <code>JSValue</code>ï¼šå…è®¸ä½¿ç”¨<code>å­—ç¬¦ä¸²</code>æˆ–<code>æ•´æ•°</code>æ ‡æ¥å¾—åˆ°é‡Œé¢çš„å¯¹è±¡å’Œæ•°ç»„</p>

<h4 id="jscontextä¸‹æ ‡å–å€¼">JSContextä¸‹æ ‡å–å€¼</h4>

<ol>
<li><code>swift</code>è¯­æ³•
{% codeblock æœªæ˜ å°„æˆ[]çš„åŸå§‹æ–¹æ³• lang:swift <a href="http://nshipster.cn/object-subscripting/">http://nshipster.cn/object-subscripting/</a> objectAtKeyedSubscript()å’ŒobjectAtIndexedSubscript() %}
let names = context.objectForKeyedSubscript(&ldquo;names&rdquo;)  //JSContextå­—ç¬¦ä¸²ä¸‹æ ‡åŸå§‹æ–¹æ³•
{% endcodeblock %}</li>
</ol>

<h4 id="jsvalueæ•´æ•°ä¸‹æ ‡åŸå§‹æ–¹æ³•">JSValueæ•´æ•°ä¸‹æ ‡åŸå§‹æ–¹æ³•</h4>

<p>{% codeblock æœªæ˜ å°„æˆ[]çš„åŸå§‹æ–¹æ³• lang:swift <a href="http://nshipster.cn/object-subscripting/">http://nshipster.cn/object-subscripting/</a> objectAtKeyedSubscript()å’ŒobjectAtIndexedSubscript() %}
let initialName = names.objectAtIndexedSubscript(0)   //JSValueæ•´æ•°ä¸‹æ ‡åŸå§‹æ–¹æ³•
println(&ldquo;The first name: (initialName.toString())&ldquo;)  //JSValue method
// The first name: Grace
{% endcodeblock %}</p>

<blockquote>
<p>åœ¨è¿™é‡Œï¼ŒObjective-C ä»£ç å¯ä»¥åˆ©ç”¨ä¸‹æ ‡è¡¨ç¤ºæ³•ï¼Œå¦‚ä¸‹ä¾‹ï¼šcontext[@&ldquo;names&rdquo;]ï¼Œnames[0]ï¼Œ[initialName toString]ï¼ŒSwift ç›®å‰åªå…¬å¼€<a href="http://nshipster.cn/object-subscripting/">åŸå§‹æ–¹æ³•</a>:<code>objectAtKeyedSubscript()</code> å’Œ <code>objectAtIndexedSubscript()</code>æ¥è®©ä¸‹æ ‡æˆä¸ºå¯èƒ½ã€‚</p>
</blockquote>

<h3 id="callwithargumentsè°ƒç”¨jsæ–¹æ³•-åªéœ€ä¼ å…¥foundationåŸºæœ¬ç±»å‹å‚æ•°">callWithArgumentsè°ƒç”¨JSæ–¹æ³•ï¼šåªéœ€ä¼ å…¥FoundationåŸºæœ¬ç±»å‹å‚æ•°</h3>

<p>ä¸Šè¿°<code>JavaScript</code>ä»£ç ä¸­ï¼Œ<code>JSValue</code>åŒ…è£…äº†ä¸€ä¸ª<code>tripleå‡½æ•°</code>ï¼Œåœ¨<code>Objective-C / Swift</code> ä»£ç ä¸­å¯ä»¥ä½¿ç”¨ <code>FoundationåŸºæœ¬ç±»å‹</code>ä½œä¸ºå‚æ•°æ¥ç›´æ¥è°ƒç”¨è¯¥å‡½æ•°ã€‚å†æ¬¡ï¼Œ<code>JavaScriptCore</code> å¾ˆè½»æ¾çš„å¤„ç†äº†è¿™ä¸ªæ¡¥æ¥ï¼š
{% codeblock lang:swift %}<br />
let tripleFunction = context.objectForKeyedSubscript(&ldquo;triple&rdquo;) //ä¸‹æ ‡å–å€¼
let result = tripleFunction.callWithArguments([5]) //ä¼ å…¥åŸºæœ¬ç±»å‹å‚æ•°ç›´æ¥è°ƒç”¨
println(&ldquo;Five tripled: (result.toInt32())&ldquo;)
{% endcodeblock %}</p>

<h3 id="exceptionhandler-é”™è¯¯å¤„ç†"><code>exceptionHandler</code>é”™è¯¯å¤„ç†</h3>

<p><code>exceptionHandler</code> æ˜¯ä¸€ä¸ªæ¥æ”¶<code>JSContext å¼•ç”¨</code>å’Œ<code>å¼‚å¸¸æœ¬èº«</code>çš„å›è°ƒå¤„ç†çš„é—­åŒ…ã€‚
é€šè¿‡è®¾ç½®ä¸Šä¸‹æ–‡çš„ <code>exceptionHandler</code> å±æ€§ï¼Œå¯ä»¥è§‚å¯Ÿå’Œè®°å½•<code>è¯­æ³•</code>ï¼Œ<code>ç±»å‹</code>ä»¥åŠ<code>è¿è¡Œæ—¶é”™è¯¯</code>:
{% codeblock lang:swift %}
context.exceptionHandler = { context, exception in
println(&ldquo;JS Error: (exception)&ldquo;)
}</p>

<p>context.evaluateScript(&ldquo;function multiply(value1, value2) { return value1 * value2 &ldquo;)
// JS Error: SyntaxError: Unexpected end of script
{% endcodeblock %}
{% codeblock  lang:objc %}
context.exceptionHandler = ^(JSContext *context, JSValue *exception) {
NSLog(@&ldquo;JS Error: %@&ldquo;, exception);
};</p>

<p>[context evaluateScript:@&ldquo;function multiply(value1, value2) { return value1 * value2 &ldquo;];
// JS Error: SyntaxError: Unexpected end of script
{% endcodeblock %}</p>

<h2 id="javascript-é€šè¿‡jscontextè°ƒç”¨-swift-oc">JavaScript é€šè¿‡JSContextè°ƒç”¨ swiftï¼OC</h2>

<p>æ€æ ·ä» <code>JavaScript</code> è®¿é—®æˆ‘ä»¬åœ¨ <code>Objective-C</code>æˆ– <code>Swift</code> å®šä¹‰çš„å¯¹è±¡å’Œæ–¹æ³•ï¼Ÿ
è®© <code>JSContext</code> è®¿é—®æˆ‘ä»¬çš„æœ¬åœ°å®¢æˆ·ç«¯ä»£ç çš„æ–¹å¼ä¸»è¦æœ‰ä¸¤ç§ï¼š
1. <code>blockå—</code>é”®å€¼å¯¹ï¼šæŠŠOCä¸­çš„<code>blockå—</code>èµ‹å€¼ç»™<code>JSContext</code>çš„ä¸€ä¸ªæ ‡ç¤ºé”®ï¼Œè¯¥æ ‡è¯†é”®çš„<code>JSValue</code>å¯ä»¥é€šè¿‡<code>callWithArguments</code>è°ƒç”¨.
2. <code>JSExport åè®®</code>ã€‚</p>

<h3 id="blockå—-é”®å€¼å¯¹-è¯¥blocké”®çš„-jsvalue-é€šè¿‡-callwitharguments-è°ƒç”¨">blockå— é”®å€¼å¯¹:è¯¥blocké”®çš„<code>JSValue</code>é€šè¿‡<code>callWithArguments</code>è°ƒç”¨</h3>

<p>å½“ä¸€ä¸ª <code>Objective-C block</code> è¢«èµ‹ç»™ <code>JSContext</code> é‡Œçš„ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œ<code>JavaScriptCore</code> ä¼šè‡ªåŠ¨çš„æŠŠ <code>block</code> å°è£…åœ¨ <code>JavaScript å‡½æ•°</code>é‡Œï¼Œå¹¶ä»¥è¯¥æ ‡ç¤ºç¬¦ä½œä¸ºå‡½æ•°åæ¥è°ƒç”¨è¯¥blockçš„å®ç°ã€‚è¿™ä½¿å¾—åœ¨ <code>JavaScript</code> ä¸­å¯ä»¥ç®€å•çš„ä½¿ç”¨ <code>Foundation</code> å’Œ <code>Cocoa</code>ç±»ï¼Œæ‰€æœ‰çš„æ¡¥æ¥éƒ½ä¸ºä½ åšå¥½äº†ã€‚
<a href="http://nshipster.cn/cfstringtransform/">CFStringTransform</a>å¤„ç†è¯­è¨€çš„å¼ºå¤§å¨åŠ›</p>

<p>åœ¨ <code>JSContext</code> ä¸­ä½¿ç”¨ <code>Swift é—­åŒ…</code>éœ€è¦æ³¨æ„ä¸¤ç‚¹:
1. ä¸ <code>@objc_block</code> å±æ€§ä¸€èµ·å£°æ˜
2. ä½¿ç”¨Swiftä¸­çš„<code>unsafeBitCast()</code>å‡½æ•°ï¼ŒæŠŠå¯¹è±¡è½¬æ¢ä¸º<code>AnyObject</code></p>

<p>{% codeblock lang:swift %}
let simplifyString: @objc_block String -&gt; String = { input in
    var mutableString = NSMutableString(string: input) as CFMutableStringRef
    CFStringTransform(mutableString, nil, kCFStringTransformToLatin, Boolean(0))
    CFStringTransform(mutableString, nil, kCFStringTransformStripCombiningMarks, Boolean(0))
    return mutableString
}
context.setObject(unsafeBitCast(simplifyString, AnyObject.self), forKeyedSubscript: &ldquo;simplifyString&rdquo;)
//é€šè¿‡simplifyStringæ ‡ç¤ºç¬¦æ¥è°ƒç”¨blockçš„å®ç°
println(context.evaluateScript(&ldquo;simplifyString(&lsquo;ì•ˆë…•í•˜ìƒˆìš”!&rsquo;)&rdquo;))
// annyeonghasaeyo!
{% endcodeblock %}</p>

<p>{% codeblock lang:objc %}
//ç»™æ ‡ç¤ºç¬¦èµ‹å€¼ä¸€ä¸ªoc-blockï¼Œè¯¥æ ‡ç¤ºç¬¦ä¼šè¢«è‡ªåŠ¨è£…æ¢ä¸ºJavaScriptå‡½æ•°
context[@&ldquo;simplifyString&rdquo;] = ^(NSString *input) {
NSMutableString *mutableString = [input mutableCopy];
CFStringTransform((<strong>bridge CFMutableStringRef)mutableString, NULL, kCFStringTransformToLatin, NO);
CFStringTransform((</strong>bridge CFMutableStringRef)mutableString, NULL, kCFStringTransformStripCombiningMarks, NO);
return mutableString;
};</p>

<p>//é€šè¿‡simplifyStringæ ‡ç¤ºç¬¦æ¥è°ƒç”¨blockçš„å®ç°
NSLog(@&ldquo;%@&rdquo;, [context evaluateScript:@&ldquo;simplifyString(&lsquo;ì•ˆë…•í•˜ìƒˆìš”!&rsquo;)&rdquo;]);
{% endcodeblock %}</p>

<h4 id="å†…å­˜ç®¡ç†">å†…å­˜ç®¡ç†</h4>

<p>ç”±äº <code>block</code> å¯ä»¥ä¿æœ‰å˜é‡å¼•ç”¨ï¼Œè€Œä¸” <code>JSContext</code> ä¹Ÿå¼ºå¼•ç”¨å®ƒæ‰€æœ‰çš„å˜é‡ï¼Œä¸ºäº†é¿å…å¼ºå¼•ç”¨å¾ªç¯éœ€è¦ç‰¹åˆ«å°å¿ƒã€‚
é¿å…ä¿æœ‰<code>JSContext</code> æˆ–<code>ä¸€ä¸ª block</code> é‡Œçš„ä»»ä½• <code>JSValue</code>ã€‚ç›¸åï¼Œä½¿ç”¨ <code>[JSContext currentContext]</code> å¾—åˆ°å½“å‰ä¸Šä¸‹æ–‡ï¼Œå¹¶æŠŠä½ éœ€è¦çš„ä»»ä½•å€¼ç”¨å‚æ•°ä¼ é€’ã€‚</p>

<h3 id="jsexport-åè®®">JSExport åè®®</h3>

<p>åœ¨ç»§æ‰¿<code>JSExport åè®®</code>çš„å­åè®®é‡Œå£°æ˜çš„å±æ€§ï¼Œå®ä¾‹æ–¹æ³•è¿˜æ˜¯ç±»æ–¹æ³•ï¼Œéƒ½ä¼šè‡ªåŠ¨æš´æ¼ç»™<code>JavaScript</code>ä»£ç æ¥è°ƒç”¨ã€‚</p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">æ–‡ç« ä½œè€…</span>
    <span class="item-content">iTBoyer</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">ä¸Šæ¬¡æ›´æ–°</span>
    <span class="item-content">
        2019-08-08
        <a href="iEmacsd/commit/ccacacd56ce82e709b32bc57ad0c707301dbd1e0" title="è¿ç§»mdæ–‡æ¡£">(ccacacd)</a>
    </span>
  </p>
  
  
</div>
<div class="post-reward">
  <input type="checkbox" name="reward" id="reward" hidden />
  <label class="reward-button" for="reward">èµèµæ”¯æŒ</label>
  <div class="qr-code">
    
    <label class="qr-code-image" for="reward">
        <img class="image" src="/path/to/your/wechat-qr-code.png">
        <span>å¾®ä¿¡æ‰“èµ</span>
      </label>
    <label class="qr-code-image" for="reward">
        <img class="image" src="/path/to/your/alipay-qr-code.png">
        <span>æ”¯ä»˜å®æ‰“èµ</span>
      </label>
  </div>
</div><footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/javascriptcore/">Javaâ€‹Scriptâ€‹Core</a>
          <a href="/tags/%E6%B7%B7%E7%BC%96/">æ··ç¼–</a>
          <a href="/tags/swift/">swift</a>
          <a href="/tags/%E8%AF%AD%E6%B3%95/">è¯­æ³•</a>
          <a href="/tags/ios/">iOS</a>
          <a href="/tags/macos/">macOS</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/swift/%E4%BD%BF%E7%94%A8javascript%E6%8A%8Ajson%E6%95%B0%E6%8D%AE%E5%AE%9A%E4%B9%89%E5%AF%B9%E8%B1%A1/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">ä½¿ç”¨JavaScriptæŠŠJSONæ•°æ®å®šä¹‰å¯¹è±¡</span>
            <span class="prev-text nav-mobile">ä¸Šä¸€ç¯‡</span>
          </a>
        <a class="next" href="/post/git/%E7%94%A8git%E5%B0%86%E4%BB%A3%E7%A0%81%E6%81%A2%E5%A4%8D%E5%88%B0%E4%B8%80%E4%B8%AA%E5%8E%86%E5%8F%B2%E7%9A%84%E7%89%88%E6%9C%AC/">
            <span class="next-text nav-default">ç”¨Gitå°†ä»£ç æ¢å¤åˆ°ä¸€ä¸ªå†å²çš„ç‰ˆæœ¬</span>
            <span class="next-text nav-mobile">ä¸‹ä¸€ç¯‡</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        <div id="comments-gitment"></div>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/theme-next/theme-next-gitment@1/default.min.css" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/gh/theme-next/theme-next-gitment@1/gitment.browser.min.js" crossorigin="anonymous"></script>
    <script type="text/javascript">
      var gitment = new Gitment({
        id: '2017-02-12 13:34:06 \x2b0000 UTC',
        title: 'Javaâ€‹Scriptâ€‹Coreå®ç°swiftæ··ç¼–',
        link: decodeURI(location.href),
        desc: 'OS X Mavericks å’Œ iOS 7 å¼•å…¥äº† JavaScriptCore åº“ï¼Œå®ƒæŠŠ WebKit çš„ JavaScript å¼•æ“ç”¨ Objective-C å°è£…ï¼Œæä¾›äº†ç®€å•ï¼Œå¿«é€Ÿä»¥åŠå®‰å…¨çš„æ–¹å¼æ¥å…¥ä¸–ç•Œä¸Šæœ€æµè¡Œçš„è¯­è¨€ã€‚ä¸ç®¡ä½ çˆ±å®ƒè¿˜æ˜¯æ¨å®ƒï¼ŒJavaScrip',
        owner: 'huos3203',
        repo: 'huos3203.github.io',
        oauth: {
          client_id: 'd46ea301857e36a08319',
          client_secret: '9da00f1f475c4166b96fbe157d0afdbd64cc613c'
        }
      });
      gitment.render('comments-gitment');
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/imsun/gitment">comments powered by gitment.</a></noscript>
  
  

  
    <script src="https://utteranc.es/client.js"
            repo="huos3203/huos3203.github.io"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:iTBoyer@qq.com" class="iconfont icon-email" title="email"></a>
      <a href="https://github.com/huos3203" class="iconfont icon-github" title="github"></a>
      <a href="http://weibo.com/1791281385" class="iconfont icon-weibo" title="weibo"></a>
      <a href="http://www.zhihu.com/people/boyers" class="iconfont icon-zhihu" title="zhihu"></a>
      <a href="http://douban.com/people/boyers" class="iconfont icon-douban" title="douban"></a>
      <a href="http://localhost:1313" class="iconfont icon-bilibili" title="bilibili"></a>
  <a href="https://huos3203.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    ç”± <a class="hexo-link" href="https://gohugo.io">Hugo</a> å¼ºåŠ›é©±åŠ¨
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    ä¸»é¢˜ - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv"> æœ¬ç«™æ€»è®¿é—®é‡ <span id="busuanzi_value_site_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> æ¬¡ </span>
      <span class="division">|</span>
    <span id="busuanzi_container_site_uv"> æœ¬ç«™æ€»è®¿å®¢æ•° <span id="busuanzi_value_site_uv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> äºº </span>
  </div>

  <span class="copyright-year">
    &copy; 
    2017 - 
    2019
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">iTBoyer</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script src="/lib/highlight/highlight.pack.js?v=20171001"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>
<script type="text/javascript" src="/dist/even.26188efa.min.js"></script>








</body>
</html>
